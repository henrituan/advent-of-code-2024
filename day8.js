const parseInput = (input) => {
  const rows = input.split("\n");
  const grid = rows.map((row) => row.split(""));
  return grid;
};

const getAntiNodes = (node1, node2, maxX, maxY) => {
  const deltaX = node1.x - node2.x;
  const deltaY = node1.y - node2.y;

  let anitNode1 = { x: node1.x + deltaX, y: node1.y + deltaY };
  let anitNode2 = { x: node2.x - deltaX, y: node2.y - deltaY };

  if (
    anitNode1.x > maxX ||
    anitNode1.y > maxY ||
    anitNode1.x < 0 ||
    anitNode1.y < 0
  )
    anitNode1 = null;
  if (
    anitNode2.x > maxX ||
    anitNode2.y > maxY ||
    anitNode2.x < 0 ||
    anitNode2.y < 0
  )
    anitNode2 = null;

  return [anitNode1, anitNode2].filter((node) => node !== null);
};

const main = () => {
  const input = parseInput(input2);

  const maxY = input.length - 1;
  const maxX = input[0].length - 1;

  const nodeGroups = {};
  let markedNodes = [];

  for (let i = 0; i <= maxY; i++) {
    for (let j = 0; j <= maxX; j++) {
      const cell = input[i][j];

      if (cell === "." || cell === "#") continue;

      if (nodeGroups[cell]) {
        nodeGroups[cell].push({ x: j, y: i });
      } else {
        nodeGroups[cell] = [{ x: j, y: i }];
      }
    }
  }

  Object.values(nodeGroups).forEach((nodeGroup) => {
    for (let i = 0; i < nodeGroup.length - 1; i++) {
      for (let j = i + 1; j < nodeGroup.length; j++) {
        const node1 = nodeGroup[i];
        const node2 = nodeGroup[j];

        const antiNodes = getAntiNodes(node1, node2, maxX, maxY);

        antiNodes.forEach((antiNode) => {
          const str = `${antiNode.x}_${antiNode.y}`;
          if (!markedNodes.includes(str)) {
            markedNodes.push(str);
          }
        });
      }
    }
  });

  console.log(markedNodes);
  console.log(markedNodes.length);
};

const input1 = `............
........0...
.....0......
.......0....
....0.......
......A.....
............
............
........A...
.........A..
............
............`;

const input2 = `........5..................................e..3...
.......q...........m................e.............
....m.......................................e.....
.........................................C........
.u.m........................8.....................
...........7......9.......8...........F...s.......
6...q..............................s..............
..................................................
..................................................
..................................................
..........9....................F..................
.................................M....D...........
.........U........................................
..q................................8..............
.......9..........................................
0....6.....................e..Qs...............F..
.................................Q...D............
.0.u....................................2.........
..................................................
........u................Q........................
.....E........1...................................
...n....v....................................3....
......u..0................N.......................
............................................z.....
.........7....U.........4.....Z...Q.....D.....V...
..............n1.........f.................2......
E.............................f..............z....
...E........1.Z.......U......................D....
.......n...v....7Z...N............................
..........7..N.....Zf...........................3.
................................b............V....
............4..................................9..
..n...v........................5................2.
.........v.................5.........S............
..........................s.......................
.....U.........4..C.....................S..V......
..................................................
......................c........b............M.....
...........4.Wc....d.......1.....b.....S..........
..E........c............................5......z..
..............w..C....................SM.2........
........................d.........................
...............c......C3..........................
...............w....W.............................
..................................................
.........d.......B....w...........................
....B.....W.......dw..........................M...
...............W......................N...V.......
.B................................................
....................B...............b.............`;

main();
